module.exports = {
  friendlyName: 'Get access token',
  description: 'Generate a new access token for acting on behalf of a particular Twitter user account.',
  extendedDescription: '',
  inputs: {
    consumerKey: {
      example: 'xAmBxAmBxAmBkjbyKkjbyKkjbyK',
      description: 'The oauth_consumer_key identifies which application is making the request. ',
      required: true,
      whereToGet: {
        url: 'http://dev.twitter.com/apps',
        description: 'Copy and paste an API key, or create one if you haven\'t already.',
        extendedDescription: ''
      }
    },
    consumerSecret: {
      example: 'xAmBxAmBxAmBkjbyKkjbyKkjbyK',
      description: 'The oauth_consumer_key identifies which application is making the request. ',
      required: true,
      whereToGet: {
        url: 'http://dev.twitter.com/apps',
        description: 'Copy and paste an API key, or create one if you haven\'t already.',
        extendedDescription: ''
      }
    },
    oauthToken: {
      example: 'QDvCav5zRSafS795TckAerUV53xzgqRyrcfYX2i_PJFObCvACVRP-V7sfemiMPBh3TWypvagfZ6aoqfwKCNcBxg8XR_skdYUe5tsY9UzX9Z_8q4mR',
      description: 'The OAuth token generated by Twitter and sent to the callbackUrl if the user chooses to grant your app the requested permissions.',
      required: true
    },
    oauthVerifier: {
      example: 'QDvCav5zRSafS795TckAerUV53xzgqRyrcfYX2i_PJFObCvACVRP-V7sfemiMPBh3TWypvagfZ6aoqfwKCNcBxg8XR_skdYUe5tsY9UzX9Z_8q4mR',
      description: '',
      required: true
    }
  },
  defaultExit: 'success',
  exits: {
    error: {
      description: 'Unexpected error occurred.'
    },
    success: {
      description: 'Returns the user\'s permanent tokens, id, and screen name.',
      example: {
        oauth_token: '847489329-998DSdafaasdDSF08asdfda08agf6ad6fsdaa08dasdaf76sa5',
        oauth_token_secret: 'SDFSssdfsdf9&SDfSDFSDFSfd9877ssdf',
        user_id: '7423224234',
        screen_name: 'johngalt'
      }
    }
  },
  fn: function(inputs, exits) {

    var request = require('request');
    var qst = require('querystring');

    var oauth = {
      consumer_key: inputs.consumerKey,
      consumer_secret: inputs.consumerSecret,
      token: inputs.oauthToken,
      verifier: inputs.oauthVerifier
    }

    var url = 'https://api.twitter.com/oauth/access_token';

    request.post({
      url: url,
      oauth: oauth
    }, function(e, r, body) {
      var perm_token = qst.parse(body);      

      if (e) {
        return exits.error(e);
      }
      return exits.success(perm_token);

    });
  }
}